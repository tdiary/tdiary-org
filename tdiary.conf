# 日記データベースを作成するディレクトリ【必須】
#   日記のデータを保存するディレクトリです。このディレクトリは通常、WWW
#   経由でアクセスできない(public_html配下でない)ディレクトリを指定しま
#   す。このディレクトリは、WWWサーバの権限で書き込めるパーミッションに
#   しておく必要があります。
require 'tempfile'
@data_path = Dir.tmpdir

#
# specify Blog style
#   - No section anchor in the article.
#   - automatic generate new date when update.
#
#@style = 'GFM'
@style = 'BlogWiki' # if you want to write by Wiki style.

@io_class = TDiary::IO::MongoDB
@database_url = ENV['MONGODB_URI']

@index = './'
@update = 'update.rb'
@logger = Logger.new($stderr)

@options['apply_plugin'] = true

@options['comment_mail.smtp_host'] = 'smtp.sendgrid.net'
@options['comment_mail.smtp_port'] = 587
@options['comment_mail.user_name'] = ENV['SENDGRID_USERNAME']
@options['comment_mail.password'] = ENV['SENDGRID_PASSWORD']
@options['comment_mail.authentication'] = :plain
@options['comment_mail.starttls'] = true

@options['squeeze.output_path'] = '/var/www/tdiary.org/html'
@options['squeeze.suffix'] = '.html'
@options['squeeze.compat_path'] = true
@options['whatsnew_list.rdf'] = './index.rdf'
@options['whatsnew_list.rdf.description'] = '日記コミュニケーションを加速する - ツッコミ可能なWeb日記システム"tDiary"公式サイト'

#-------
# CGIで変更できる項目群。必要なら書き換えて使用してください。なお、一度
# CGIで設定してしまうと、こちらのファイルを編集しても反映されません。
#-------

# あなたの名前とメールアドレス
#   @author_nameにはあなたの名前を、@author_mailにはあなたのメールアドレ
#   スを指定します。この値は、HTML化された日記のヘッダ部分に埋め込まれま
#   す。
@author_name = 'tDiary.org'
@author_mail = 'info@tdiary.org'

# 日記より上位のコンテンツがある場合に指定
#   @index_pageには、あなたの日記の表紙(またはホームページのトップページ)
#   のURLを指定してください。日記のヘッダ部分および、ページの先頭に埋め
#   込まれます。
@index_page = 'http://www.tdiary.org/'

# TITLEタグおよび携帯端末で使われる日記タイトル。
#   HTMLタグは使えません。
@html_title = 'tDiary.org'

# ヘッダ
#   日記ページの先頭部分に埋め込まれる文を指定します。「HEADER」に挟まれ
#   た部分を書き換えて下さい。そのままの形で埋め込まれるので、HTMLタグが
#   使えます。また、文字列中にはeRubyタグが使用できます。eRubyを知らなく
#   ても、以下の2つのタグはどこかに埋め込んでおかないと不便です。
#
#   <%=calendar%>
#       カレンダーを埋め込みます。このカレンダーは月ごとの日記へのリンク
#       になっています。
#   <%=navi%>
#       日記の更新などを行うためのメニューを埋め込みます。
#
@header = <<HEADER
<h1><a href="/"><img src="assets/tdiaryorg/h1.png" width="200" height="64" alt="tDiary.org - 日記コミュニケーションを加速する"></a></h1>
<ul class="global-menu">
<li><%=my '20021107', 'tDiaryについて', 'tDiaryについて'%></li>
<li><%=my '20021110', '動作環境', '動作環境'%></li>
<li><%=my '20021108', 'ドキュメント', 'ドキュメント'%></li>
<li><%=my '20021112', 'ダウンロード', 'ダウンロード'%></li>
<li><%=my '20021001', 'テーマ', 'テーマギャラリー'%></li>
<li><a href="http://docs.tdiary.org/ja/">プラグイン</a></li>
<li><%=my '20021106', '開発', '開発'%></li>
<li><%=my '20000102', 'コンタクト', 'コンタクト(フィードバック&コミュニティ)'%></li>
</ul>
<div class="main">
HEADER

# フッタ
#   ヘッダ同様、日記ページの末尾に挿入される文字列を指定できます。
#   「FOOTER」で挟まれた部分を書き換えてください。
@footer = <<FOOTER
</div>
<% unless @conf.iphone? %>
<div class="sidebar">
<% if @mode == 'latest' %>
  <div class="block">
    <p>このサイトは、ツッコミ可能なWeb日記システム"tDiary"の公式サイトです。</p>
    <p>Can you read Japanese? Try <a href="https://github.com/tdiary/tdiary-core">GitHub</a> if you can't.</p>
    <hr>
    <p><iframe src="http://www.facebook.com/plugins/likebox.php?href=http%3A%2F%2Fwww.facebook.com%2FtDiary&amp;width=237&amp;colorscheme=light&amp;show_faces=true&amp;stream=false&amp;header=true&amp;height=300" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:237px; height:300px; background-color: #fff;" allowTransparency="false"></iframe></p>
  </div>
<% end %>

  <div class="block">
    <h3>最新版のダウンロード</h3>
      <p>5.0.0 (安定版)</p>
      <ul>
        <li><a href="/download/tdiary-full-v5.0.0.tar.gz">フルセット</a></li>
        <li><a href="/download/tdiary-v5.0.0.tar.gz">基本セット</a></li>
        <li><a href="/download/tdiary-theme-v5.0.0.tar.gz">テーマ集</a></li>
        <li><a href="/download/tdiary-blogkit-v5.0.0.tar.gz">BlogKit</a></li>
        <li><a href="/download/tdiary-contrib-v5.0.0.tar.gz">contrib</a></li>
      </ul>
    <h3>Herokuへのインストール</h3>
       <p style="text-align: center;"><a href="https://www.heroku.com/deploy?template=https://github.com/tdiary/tdiary-core"><img src="https://www.herokucdn.com/deploy/button.png"></a></p>
  </div>

  <div class="block">
    <h3>サイト内検索 (Google)</h3>
    <form method="get" action="http://www.google.co.jp/search"><div>
    <input type="hidden" name="as_sitesearch" value="tdiary.org">
    <input class="field" name="as_q" style="width: 14em;"><input type="submit" value="検索">
    </div></form>
  </div>

  <div class="block">
    <h3>最近のテーマ</h3>
    <ul>
      <%=recent_themes( %w(
default
gustav
      ) )%>
    </ul>
  </div>

  <div class="block">
    <h3>最近のプラグイン</h3>
    <ul>
      <%=recent_plugins%>
<li>hide-mail-field</li>
<li>edit_today</li>
<li>akismet</li>
<li>my-sequel</li>
    </ul>
  </div>

  <div class="block">
    <h3>Twitter</h3>
      <ul>
      <a href="http://twitter.com/tDiary">@tDiary<a>
      </ul>
    <h3>Facebook</h3>
      <ul>
      <a href="http://www.facebook.com/tDiary">tDiary<a>
      </ul>

    <h3>サイト更新情報<a href="/index.rdf"><img style="border-width: 0px;" src="http://tdiary1.tdiary.net/feed-icon-12x12.png" width="12" height="12" alt="RSS feed"></a></h3>
    <%=whatsnew_list 5, 25%>
  </div>
  <div class="block">
    <h3>Webサイトスポンサー</h3>
    <div style="width:74px; height:36px; margin:0; padding:0;"><a href="http://www.cloudcore.jp/vps/?utm_source=ad&utm_medium=ad&utm_content=dev&utm_campaign=vps" target="_blank" rel="nofollow"><img src="http://www.cloudcore.jp/vps/develop/links/images/74x36_white.gif" alt="CloudCore" style="border:0; margin-bottom:4px;" /></a></div>
  </div>
</div>


<div class="adminmenu"><% if @mode != 'latest' %><%=navi_user%><% end %><%=navi_admin%></div>
<!-- twitter follow badge by go2web20 -->
<script src='http://files.go2web20.net/twitterbadge/1.0/badge.js' type='text/javascript'></script>
<script type='text/javascript' charset='utf-8'><!--
tfb.account = 'tDiary';
tfb.label = 'follow-us';
tfb.color = '#00a650';
tfb.side = 'r';
tfb.top = 140;
setTimeout( tfb.showbadge, 5000 );
//--></script>
<!-- end of twitter follow badge -->
<a href="http://github.com/tdiary"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
<% end %>
FOOTER

# 日付のフォーマットの指定
#   日記の日付のフォーマットを指定できます。デフォルトでは「YYYY-MM-DD」
#   になっています。RubyのTime::strftimeのパラメタがすべて使えますが、時
#   刻に関係する部分は指定しても意味がありません。主に使えるのは「%Y」
#   (西暦年)、「%m」(月数値)、「%b」(短月名)、「%B」(長月名)、「%d」(日)、
#   「%a」(短曜日名)、「%A」(長曜日名)といったところでしょう。
@date_format = '%Y-%m-%d'

# セクションアンカーとツッコミアンカーの指定
#   日記のセクションアンカー(@section_anchor)および「ツッコミ」アンカー
#   (@comment_anchor))に使う文字を指定します。
#   それぞれの文字列が<a href="...">〜</a>に挟まれてHTMLに展開されます。
#   なお、classがsanchor(セクションアンカーの場合)やcanchor(ツッコミアン
#   カーの場合)のspanタグを使うと、テーマによっては自動的に画像によるア
#   ンカーが付くようになります。
@section_anchor = '<span class="sanchor">■</span>'
@comment_anchor = '<span class="canchor">●</span>'

# 最新表示時に最大何日分の日記を表示するかの指定
#   最新日記を表示するページで、最大何日分の日記を出力するかを指定します。
#   指定した日数に達しない場合は、その月のすべての日記を出力します。また、
#   指定した日数に届かなかった場合には、前月以前まで遡ります。
@latest_limit = 10

# テーマ名(もしくはCSSのURL)の指定
#   日記のスタイルを決めるテーマ名もしくはCSSファイルのURLを指定します。
#   @themeには添付の標準スタイルシートを指定してあります。これを書き換え
#   て、好みのデザインにできます。themeディレクトリの下には、標準添付の
#   テーマ(*.css)がいくつかありますので、好みに応じて変更してみてくださ
#   い。
#   もちろん、自分でスタイルシートを書いてもかまいません。その場合は@theme
#   には''(空文字列)を指定し、@cssにCSSファイルのURLを記述します。
@theme = 'tdiaryorg'
@css = 'default.css'

# ツッコミを表示するかどうか(true or false)
#   「本日のツッコミ」を表示するかどうか指定します。ツッコミは@show_comment
#   をfalseにすることで読者から隠すことができます。日記のオーナー(あなた)
#   は、更新画面で日付を指定することでツッコミを見ることができます。
@show_comment = false
@hide_comment_form = false

# 最新および月別表示でツッコミを最大何件表示するか
#   「本日のツッコミ」を表示する場合、最新及び月間表示時に最大いくつまで
#   表示するかを指定します。
@comment_limit = 3

# リンク元リストを表示するかどうか(true or false)
#   「本日のリンク元」を表示するかどうか。リンク元は、日記を訪れてくれた
#   人がどのページにあるリンクをたどってきたかを示すURLです。これがわか
#   ると、自分の日記をリンクしているページがわかるので、日記コミュニケー
#   ションがとりやすくなります。tDiaryはこの情報を日記の読者にも公開する
#   ようになっていますが、@show_refererをfalseにすることで、これを抑止で
#   きます。非表示にしても、日記のオーナー(あなた)は更新画面で日付を指定
#   することでリンク元を見ることが可能です。
@show_referer = false

# 最新および月別表示でリンク元を最大何件表示するか
#   「本日のリンク元」を表示する場合、最新および月間表示時に最大いくつま
#   で表示するかを指定します。
@referer_limit = 10

# ツッコミをメールでも受けとりたい場合に指定
#   ツッコミがあったことをメールで知らせて欲しい場合の設定です。@mail_on_comment
#   をtrueにすると、以下の設定に従ってツッコミを@author_mail宛に送信しま
#   す。ツッコミのE-mailフィールドにアドレスが指定されていなかった場合に
#   は、Fromヘッダにも@author_mailが指定されます。
#   @mail_headerは、メールのSubjectに使う文字列です。振り分け等に便利な
#   ように指定してください。実際のSubjectは、「@mail_header:@date_format-1」
#   のように、日付とコメント番号が付きます。ただし、@mail_header中に%に
#   続く英字があった場合、それを日付フォーマット指定を見なします。つまり
#   「:@date_format」の部分は自動的に付加されなくなります(コメント番号は
#   付加されます)。
@mail_on_comment = true
@mail_header = 'tDiary.org'

# 更新時の時差調整
#   更新フォームに自動的に挿入される日付を調整します。単位は「時」で、小
#   数が指定できます。例えば午前2時までを前日として扱いたい場合には「-2」
#   と指定することで、実際の時刻から2時間が引かれた日付が入ります。また、
#   海外サーバ上で運用している場合の時差調整にも利用できます。
@hour_offset = 0

#-----
# CGIで追加設定できるが、ここに(CGIからは編集できない)標準設定を記述でき
# る項目
#-----

# リンク元リストから除外するURL(正規表現)
#   @no_refererは、リンク元として記録しないURLの配列を指定します。毎日定
#   期的にあるアンテナ経由の訪問者や、検索エンジンのロボットなど、本来の
#   目的(つまり自分の日記の話題に対してのリンク)を探り出すためのものでは
#   ないリンク元はノイズになってしまい、けっこう邪魔です。そのようなリン
#   ク元はここにURLを指定することで記録されなくなります。特に、自分の日
#   記のURLは必ずここに入れておくべきでしょう。書式はRubyの配列(Array)で、
#   中身は文字列です。比較時には正規表現として扱われますが、Regexpオブジ
#   ェクトは指定しないでください。
@no_referer = [
	'^http://localhost[:/]',
	'^http://192.168.',
	'^http://172.1[6789]',
	'^http://172.2[0-9]',
	'^http://172.3[01]',
	'^http://10.',
	'^http://([^.]*\.)?tdiary\.(net|org)',
	# 自分の日記のURLは追加しておくと良い
]

# リンク元リストにURLでなく特定文字列を指定する場合の変換表(正規表現)
#   @referer_tableは、「本日のリンク元」の一覧(一日単位で表示される方)に
#   味気ないURLが並ぶのを回避するための設定です。対象となるリンク元のURL
#   の正規表現文字列と、置換後の文字列をペアにした配列をアイテムに持つ配
#   列として記述します。置換後の文字列には、URL中の「(〜)」で囲まれた文
#   字列を\1、\2……といった形で置き換えることができます。上の例では、tDiary
#   で運用されている某作者の日記を日付指定、月指定、指定なしのそれぞれの
#   場合について、別々の文字列に置換しています。
@referer_table = [
	['^http://www\.tdiary\.net/.*', 'tDiary.Net'],
	['^http://sho\.tdiary.net/(\d{4})(\d\d)(\d\d)\.html', 'Asumi日記(\1-\2-\3)'],
	['^http://sho\.tdiary.net/(\d{4})(\d\d)\.html', 'Asumi日記(\1-\2)'],
	['^http://sho\.tdiary.net/.*', 'Asumi日記'],
	['^http://([^\.]*)\.tdiary\.net/(\d{4})(\d\d)(\d\d)\.html', 'tDiary.net[\1](\2-\3-\4)'],
	['^http://([^\.]*)\.tdiary\.net/(\d{4})(\d\d)\.html', 'tDiary.net[\1](\2-\3)'],
	['^http://([^\.]*)\.tdiary\.net/.*', 'tDiary.net[\1]'],
	['^http://www.google.(com|co\.jp)/search.*?q=([^&]*).*', 'google検索(\2)'],
	['^http://google.yahoo.(com|co\.jp)/.*?p=([^&]*).*', 'Yahoo内google検索(\2)'],
	['^http://www.infoseek.co.jp/.*?qt=([^&]*).*', 'Infoseek検索(\1)'],
	['^http://www.lycos.co.jp/cgi-bin/.*?query=([^&]*).*', 'Lycos検索(\1)'],
	["^http://wisenut.lycos.co.jp/.*?q=([^&]*).*", "Lycos内Wisenut検索(\\1)"],
	['^http://search.fresheye.com/.*?kw=([^&]*).*', 'FreshEye検索(\1)'],
	['^http://(www|search).goo.ne.jp/.*?MT=([^&]*).*', 'goo検索(\2)'],
	['^http://(asearch|www).nifty.com/.*?(q|Text)=([^&]*).*', '@nifty検索(\3)'],
	['^http://search-intl.netscape.com/ja/google.tmpl.*?search=([^&]*).*', 'Netscape内google検索(\1)'],
	['^http://www.excite.co.jp/.*?(search|s)=([^&]*).*', 'excite検索(\2)'],
	['^http://odin.ingrid.org/.*?key=([^&]*).*', 'ODiN検索(\1)'],
	['^http://www.kensaku.(jp|org)/search.cgi.*?key=([^&]*).*', 'kensaku.jp検索(\2)'],
	['^http://search.msn.co.jp/.*?(q|MT)=([^&]*).*', 'msn検索(\2)'],
	["^http://cgi.search.biglobe.ne.jp/cgi-bin/search.*?q=([^&]*).*", "BIGLOBE検索(\\1)"],
	#
	# 以下の設定は、上記の置換リストで変換されなかったリンク元URLのうち、
	# 50文字を越えるものの後半を省略するという設定です。これはかならず
	# @referer_tableの末尾に入っていないと意味がありません。@referer_table
	# に新しい置換ルールを追加する場合は、この上に挿入してください。
	#
	['^(.{50}).*$', '\1...'],
]

#----
# CGIによる設定ファイルを読む指定【必須】
#   セキュリティを強化したい場合(tDiaryで日記サービスを提供するなど)に
#   は、@secureをtrueにして下さい。危険な変数操作や、ファイルの読み込み
#   が制限されます。
#----
@options['sp.path'] = ['misc/plugin']
@options['sp.selected'] = %w(amazon.rb append-css.rb blog-category.rb blog-style.rb category_to_tag.rb comment_mail-smtp.rb disp_referrer.rb footnote.rb google_analytics.rb hide-mail-field.rb html_anchor.rb image.rb list.rb lm.rb socialbutton.rb squeeze.rb title-link.rb title-navi.rb whatsnew-list.rb ).join("\n")
@options['style.path'] = ['./lib/tdiary/style', '/u/apps/tdiary/blogkit/tdiary']
@secure = false
load_cgi_conf
